using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Text;
using System.Windows.Forms;

namespace XOscillo
{
   public partial class VizBuffer : VizForm
   {
      public VizBuffer()
      {
         InitializeComponent();
      }

      override public DataBlock GetDataBlock()
      {
         return graphControl.GetScopeData();
      }

      override public void CopyFrom(VizForm vf)
      {
         DataBlock db = new DataBlock( vf.GetDataBlock() );

         graphControl.SetScopeData(db);
      }

      public void LoadDataFromFile(string filename)
      {
         DataBlock db = new DataBlock();
         db.LoadXML(filename);
         graphControl.SetScopeData(db);
         Invalidate();
      }

      private void fft_Click(object sender, EventArgs e)
      {
         graphControl.DrawFFT( fft.Checked );
         Invalidate();
      }

      private void clone_Click(object sender, EventArgs e)
      {
         VizBuffer childForm = new VizBuffer();
         childForm.MdiParent = MdiParent;
         childForm.Text = Text;// +Parent.childFormNumber++;
         childForm.Show();
         childForm.WindowState = FormWindowState.Maximized;
         childForm.CopyFrom(this);
      }

      private void VizBuffer_Load(object sender, EventArgs e)
      {
         time.Items.Add(1.0);
         time.Items.Add(0.5);
         time.Items.Add(0.2);
         time.Items.Add(0.1);
         time.Items.Add(0.05);
         time.Items.Add(0.02);
         time.Items.Add(0.01);
         time.Items.Add(0.005);
         time.Items.Add(0.002);
         time.Items.Add(0.001);
         time.Items.Add(0.0005);
         time.Items.Add(0.0002);
         time.Items.Add(0.0001);
         time.Items.Add(0.00005);
         time.SelectedIndex = 10;

         graphControl.VerticalLines = new List<int>() 
         {
            //{ 0,1,9,18,48,39,48,78,87,97,107,116,125,143,152,143,171,180,185,198,203,198,213,217,222,226,231,235,240,245,250,255,260,264,274,280,285,295,301,306,311,316,321,326,335,341,346,351,360,365,370,375,380,385,390,395,400,404,409,414,419,424,429,434,444,449,454,459,464,469,485,485,517,539,550,539,561,566,571,577,582,587,592,602,613,618,623,633,638,643,653,659,664,669,674,679,684,694,700,705,714,725,730,736,746,756,767,777,788,798,803,809,814,820,830,840,851,856,862,872,898,893,914,923,934,939,945,955,965,975,996,1007,1018,1024,1039,1050,1039,1061,1067,1072,1078,1083,1094,1100,1106,1111,1117,1126,1137,1147,1153,1158,1168,1178,1183,1188,1199,1209,1215,1220,1226,1231,1236,1241,1251,1256,1261,1271,1277,1282,1287,1292,1297,1302,1313,1323,1329,1334,1339,1350,1355,1350,1365,1371,1376,1381,1386,1396,1407,1412,1418,1423,1428,1439,1450,1455,1460,1465,1471,1482,1492,1498,1503,1509,1514,1525,1535,1541,1546,1552,1558,1569,1580,1586,1591,1602,1613,1619,1624,1635,1646,1635,1657,1662,1668,1678,1690,1695,1711,1722,1732,1738,1743,1748,1754,1763,1774,1785,1795,1806,1816,1838,1843,1838,1854,1859,1865,1870,1875,1881,1891,1901,1912,1917,1923,1944,1955,1944,1975,1986,1996,2007,2017,2028,2034,2039,2044,2050,2056,2061,2072,2084,2093,2099,2126,2115,2126,2154,2159,2165,2170,2176,2181,2192,2198,2204,2214,2220,2225,2231,2236,2247,2252,2258,2263,2269,2274,2280,2290,2296,2301,2306,2312,2317,2322,2333,2338,2344,2354,2360,2365,2375,2385,2391,2396,2407,2417,2428,2433,2438,2448,2453,2459,2469,2474,2479,2484,2489,2498,2509,2518,2529,2539,2549,2559,2569,2579,2589,2599,2609,2618,2629,2639,2659,2681,2691,2713,2723,2745,2756,2767,2778,2789,2801,2823,2835,2823,2847,2858,2864,2875,2880,2875,2892,2897,2903,2909,2914,2919,2925,2930,2935,2945,2950,2955,2966,2976,2981,2976,2992,2997,3006,3012,3017,3022,3027,3032,3037,3041,3046,3051,3055,3060,3070,3074,3079,3083,3088,3093,3098,3102,3112,3117,3122,3128,3133,3137,3143,3152,3163,3184,3194,3215,3221,3215,3232,3238,3244,3249,3260,3260,3288,3260,3305,3311,3316,3327,3333,3338,3344,3349,3354,3360,3371,3376,3382,3392,3403,3409,3419,3424,3419,3445,3455,3461,3466,3477,3483,3488,3493,3498,3503,3509,3518,3530,3535,3541,3550,3561,3572,3577,3593,3604,3593,3621,3637,3648,3637,3669,3680,3691,3702,3708,3713,3724,3735,3741,3747,3753,3758,3764,3769,3780,3785,3791,3796,3802,3813,3824,3835,3841,3847,3858,3868,3874,3879,3890,3901,3907,3912,3917,3922,3928,3933,3944,3949,3955,3965,3971,3976,3982,3988,3998,4009,4019,4025,4030,4036,4041,4046,4051,4057,4062,4068,4073,4078,4084,4095,4105,4111,4117,4122,4127,4138,4148,4154,4159,4164,4169,4180,4191,4197,4202,4207,4212,4223,4234,4239,4245,4250,4255,4266,4277,4282,4288,4298,4308,4314,4320,4325,4331,4342,4347,4352,4357,4363,4384,4389,4384,4400,4405,4415,4426,4431,4437,4442,4448,4458,4469,4474,4480,4491,4502,4512,4523,4534,4540,4546,4551,4556,4562,4567,4573,4578,4589,4600,4611,4617,4623,4633,4644,4655,4676,4687,4709,4719,4709,4736,4742,4747,4753,4758,4764,4786,4796,4786,4807,4830,4841,4852,4857,4863,4869,4874,4879,4885,4896,4902,4907,4918,4924,4930,4935,4941,4951,4957,4963,4969,4974,4980,4985,4996,5002,5007,5013,5018,5023,5028,5039,5045,5050,5060,5066,5071,5082,5093,5098,5104,5114,5124,5136,5141,5147,5157,5163,5169,5179,5185,5191,5196,5211,5211,5244,5211,5264,5274,5284,5304,5314,5304,5345,5355,5364,5374,5384,5395,5405,5415,5426,5437,5447,5458,5469,5481,5492,5504,5516,5528,5539,5552,5563,5587};            
         };

      }

      private void time_SelectedIndexChanged(object sender, EventArgs e)
      {
         float secondsPerDiv = float.Parse(time.SelectedItem.ToString());
         graphControl.SetSecondsPerDivision(secondsPerDiv);
         Invalidate();
      }
   }
}
